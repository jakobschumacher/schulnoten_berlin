---
title: "Schulnoten in Pankow und Lichtenberg (2025)"
---
<style type="text/css">
/* Base styles */
.main-container {
  max-width: 1400px;
  margin-left: auto;
  margin-right: auto;
  padding: 0 15px;
}

body {
  font-size: 16px;
  line-height: 1.6;
}

h1 {
  font-size: 2em;
  margin-bottom: 0.5em;
}

/* Make leaflet map responsive */
.leaflet-container {
  width: 100% !important;
  height: 600px !important;
}

/* Responsive text */
p {
  text-align: justify;
  margin-bottom: 1em;
}

/* Tablet screens */
@media (max-width: 1024px) {
  .main-container {
    max-width: 100%;
    padding: 0 10px;
  }

  body {
    font-size: 15px;
  }

  h1 {
    font-size: 1.75em;
  }

  .leaflet-container {
    height: 500px !important;
  }
}

/* Mobile screens */
@media (max-width: 768px) {
  body {
    font-size: 14px;
  }

  h1 {
    font-size: 1.5em;
  }

  .leaflet-container {
    height: 400px !important;
  }

  p {
    text-align: left;
  }
}

/* Small mobile screens */
@media (max-width: 480px) {
  .main-container {
    padding: 0 5px;
  }

  body {
    font-size: 13px;
  }

  h1 {
    font-size: 1.3em;
  }

  .leaflet-container {
    height: 350px !important;
  }
}
</style>

Die Sekundarschulen in Berlin (Gymnasium, Integrierte Sekundarschule, Gemeinschaftsschule) haben Aufnahmekritierien für die Aufnahme von Kindern ab Jahrgangsstufe 7. Dabei werden die folgenden Kriterien angewendet 1) Härtefälle 2) die Auswahlkriterien der Schule 3) den Losentscheid. Die Auswahlkriterien der Schule beinhalten eine Durchschnittsnote des Kindes aus den Halbjahren 2 der 5. Klasse und Halbjahr 1 der 6. Klasse (Durchschnittsnoten). Um eine Auswahl der Schule zu treffen muss der Notenschnitt der Schule bekannt sein, damit man weiß ob die Schule für die Schülerin/den Schüler realistisch ist. Diese Seite versucht die  Noten auf einer Karte darzustellen, die über Fragdenstaat.de von den Schulämtern bereit gestellt wurden.




```{r, warning=FALSE, message=FALSE, echo=FALSE, out.width="100%"}
library(tidyverse)
library(httr)
library(sf)
library(leaflet)
library(htmltools)

# Read in data ------------------------------------------------------------

source("get_data.R")
pankow <- get_school_grades_pankow() %>%
  rename(note_pankow = note) %>%
  mutate(schuljahr = "2023")

# Combine all Lichtenberg data (historical + 2025)
lichtenberg_historical <- get_school_grades_lichtenberg() %>%
  mutate(note = ifelse(is.na(note), "ohne Note", as.character(note)))

lichtenberg_2025 <- get_school_grades_lichtenberg_2025()

lichtenberg_all <- bind_rows(lichtenberg_historical, lichtenberg_2025) %>%
  mutate(note = ifelse(is.na(note), "ohne Note", as.character(note)))

schulen <- get_school_mapdata() %>%
  rename(lon = X, lat = Y) %>%
  filter(schultyp %in% c("Integrierte Sekundarschule", "Gymnasium")) %>%
  mutate(name = str_remove(name, pattern =" \\(Integrierte Sekundarschule\\)")) %>%
  mutate(name = str_remove(name, pattern =" \\(Gemeinschaftsschule\\)")) %>%
  mutate(name = str_remove(name, pattern ="-Schule")) %>%
  mutate(name = str_remove(name, pattern ="-Gemeinschaftsschule")) %>%
  mutate(name = str_remove(name, pattern ="-Gymnasium"))


# Join datasets -----------------------------------------------------------

# First, aggregate multi-year data into formatted strings per school
lichtenberg_summary <- lichtenberg_all %>%
  arrange(name, schuljahr) %>%
  group_by(name) %>%
  summarise(
    note_years = paste(schuljahr, ":", note, collapse = " | "),
    latest_note = last(note),
    .groups = "drop"
  )

pankow_summary <- pankow %>%
  group_by(name) %>%
  summarise(
    note_years = paste(schuljahr, ":", note_pankow, collapse = " | "),
    latest_note = note_pankow,
    .groups = "drop"
  )

df <- schulen %>%
  filter(bezirk == "Pankow" | bezirk == "Lichtenberg") %>%
  select(name, schultyp, bezirk, website, lon, lat) %>%
  left_join(lichtenberg_summary, by = join_by(name)) %>%
  rename(note_years_lichtenberg = note_years, latest_note_lichtenberg = latest_note) %>%
  left_join(pankow_summary, by = join_by(name)) %>%
  rename(note_years_pankow = note_years, latest_note_pankow = latest_note) %>%
  mutate(note_years = ifelse(bezirk == "Pankow", note_years_pankow, note_years_lichtenberg)) %>%
  mutate(latest_note = ifelse(bezirk == "Pankow", latest_note_pankow, latest_note_lichtenberg)) %>%
  mutate(gruppe = "note-vorhanden") %>%
  mutate(gruppe = ifelse(latest_note == "ohne Note", "ohne-note", gruppe)) %>%
  mutate(gruppe = ifelse(is.na(latest_note), "keine-daten", gruppe)) %>%
  mutate(note_years = ifelse(is.na(note_years), "keine Daten", note_years))



# Setup leaflet -----------------------------------------------------------


pal <- colorFactor(c('black', 'darkred', 'darkgreen'),
                   domain =c("note-vorhanden", "ohne-note", "keine-daten"))
legende <- htmltools::tags$div(
  style = "padding: 10px; background: white; border-radius: 5px; font-size: 12px; max-width: 250px; box-shadow: 0 0 15px rgba(0,0,0,0.2);",
  htmltools::HTML('<b>Warnhinweise:</b><br>
  Es kann keine Haftung übernommen werden. Bitte alle Daten kontrollieren!<br>
  <b>Datenquelle:</b> <br>
       Lichtenberg: <a href="https://fragdenstaat.de/a/297001">Schulamt über Fragdenstaat.de</a><br>
       Pankow: <a href="https://fragdenstaat.de/a/296999">Schulamt über Fragdenstaat.de</a>')
)



# Start leaflet -----------------------------------------------------------

# Create enhanced labels with HTML
create_label <- function(name, website, note_years) {
  label_parts <- c(paste0("<b>", name, "</b>"))

  if (!is.na(website) && website != "") {
    label_parts <- c(label_parts, paste0('<a href="', website, '" target="_blank">Website</a>'))
  }

  label_parts <- c(label_parts, paste0("Noten: ", note_years))

  htmltools::HTML(paste(label_parts, collapse = "<br/>"))
}

# Apply labels to each school
df <- df %>%
  rowwise() %>%
  mutate(popup_label = list(create_label(name, website, note_years))) %>%
  ungroup()

leaflet(options = leafletOptions(
  zoomControl = TRUE,
  attributionControl = TRUE,
  preferCanvas = TRUE
)) %>%
  addTiles() %>%
  setView(lng = 13.48, lat = 52.56, zoom = 12) %>%
  addCircleMarkers(
    lng = df$lon,
    lat = df$lat,
    color = pal(df$gruppe),
    radius = 8,
    popup = df$popup_label,
    label = df$name,
    labelOptions = labelOptions(
      style = list("font-size" = "14px"),
      direction = "auto"
    )
  ) %>%
  addControl(legende, position = "bottomleft")


```

